<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <script src="react.development.js"></script>
    <script src="react-dom.development.js"></script>
    <script src='babel.js'></script>
    <script src='react-router-dom.js'></script>
    <link href="style.css" rel="stylesheet">
    <title>YODAZ</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="text/jsx">
    var HashRouter = ReactRouterDOM.HashRouter;
    var Link = ReactRouterDOM.Link;
    var Route = ReactRouterDOM.Route;

    class Cities extends React.Component {

      constructor(props){
        super()
        this.state = {
          cities: [],
          id: undefined,
          city: undefined,
          population: undefined,
          newCity: undefined,
          newPopulation: undefined
        }

        this.onDeleteClick = this.onDeleteClick.bind(this)
        this.onEditClick = this.onEditClick.bind(this)
        this.onEditChange = this.onEditClick.bind(this)
        this.onNewCityClick = this.onNewCityClick.bind(this)
        this.onNewCityTextChange = this.onNewCityTextChange.bind(this)
      }

      componentDidMount(){
        fetch('http://cities.jonkri.se/')
        .then(response => response.json())
        .then(result => {
          console.log(result);
          this.setState({ cities: result}) })
      }

      onDeleteClick(event) {
        console.log(event.target.dataset.id);
        var inputId = event.target.dataset.id;
        fetch(('http://cities.jonkri.se/' + inputId ) , { method: "DELETE" })
        alert("You deleted city with id \"" + event.target.dataset.id + "\".");

      }

      onEditChange() {
        fetch('http://cities.jonkri.se/' + this.state.id, {
          body: JSON.stringify({ "name": this.state.newCity, "population": this.state.newPopulation }),
          headers: {
            'Content-Type': 'application/json'
          },
          method: 'PUT'
        }).then(function (response) {
          return response.json();
        }).then( result =>  {
          console.log(result);
        });
      }

      onEditClick(event) {
        console.log(event.target.dataset.id);
      }

      onNewCityClick(event) {
        console.log("City is: " + this.state.city);
        console.log("Population is: " + this.state.population);

        if (this.state.city != "" && this.state.population != ""){
          if (this.state.population != 0){
            fetch("http://cities.jonkri.se/", {
              body: JSON.stringify({ "name": this.state.city, "population": this.state.population }),
              headers: {
                "Content-Type": "application/json"
              },
              method: 'POST'
            });
            alert("You sucessfully added " + this.state.city + " with a population of " + this.state.population + ". Nice!");
            document.getElementById("inputcity").value = "";
            document.getElementById("inputpop").value = "";
          } else {
            alert("The city must have at least one citizen, right?");
          }
        } else {
          alert("You must fill all the fields.");
        }
      }

    onNewCityTextChange(event) {
      if (event.target.id == "inputcity") {
        this.setState({city: event.target.value})
      } else {
        this.setState({population: event.target.value})
      }
    }

      render(){
        var citiesToRender = this.state.cities.map(city =>
          <tr key={city.id} id={city.id} >
            <td>{city.name}</td>
            <td>{city.population}</td>
            <td>
              <button id="penBtn" data-name={city.name} data-population={city.population} data-id={city.id}  onClick={this.onEditClick}>ðŸ–Š</button>
              <button id="deleteBtn" data-name={city.name} data-population={city.population} data-id={city.id}  onClick={this.onDeleteClick}>ðŸ—‘</button>
            </td>
          </tr>)

        return <div>
          <table>
            <thead>
              <tr>
                <th>Stad</th>
                <th>Antal</th>
                <th>Ã„ndra</th>
              </tr>
            </thead>
            <tbody>
              {citiesToRender}
            </tbody>
          </table>
          <input id="inputcity" city={this.state.city} onChange={this.onNewCityTextChange}/>
          <input id="inputpop" type="number" population={this.state.population} onChange={this.onNewCityTextChange}/>
          <button onClick={this.onNewCityClick}>ADD CITY!</button>
        </div>
      }
    }

    class EditCities extends React.Component {

    }

    class Food extends React.Component {
      render () {
        return  <section><h1>Food</h1><p>...</p></section>
      }
    }



    // MOA
    class Addcity extends React.Component {
            constructor(props) {
              super(props);
              this.state = { valuecity: "", valuepop: "" }
              this.onClick = this.onClick.bind(this)
              this.onTextChange = this.onTextChange.bind(this)
            }

            render() {
              return <section>
              <input id="inputcity" valuecity={this.state.valuecity} onChange={this.onTextChange}/>
              <input id="inputpop" type="number" valuepop={this.state.valuepop} onChange={this.onTextChange}/>
              <button onClick={this.onClick}>ADD CITY!</button>
              </section>
            }

            onClick(event) {
              console.log("City is: " + this.state.valuecity);
              console.log("Population is: " + this.state.valuepop);

              if (this.state.valuecity != "" && this.state.valuepop != ""){
                if (this.state.valuepop != 0){
                  fetch("http://cities.jonkri.se/", {
                    body: JSON.stringify({ "name": this.state.valuecity, "population": this.state.valuepop }),
                    headers: {
                      "Content-Type": "application/json"
                    },
                    method: 'POST'
                  });
                  alert("You sucessfully added " + this.state.valuecity + " with a population of " + this.state.valuepop + ". Nice!");
                  document.getElementById("inputcity").value = "";
                  document.getElementById("inputpop").value = "";
                } else {
                  alert("The city must have at least one citizen, right?");
                }
              } else {
                alert("You must fill all the fields.");
              }
            }

          onTextChange(event) {
            //console.log(event.target.value);

            if (event.target.id == "inputcity") {
              //console.log("clicked input city");
              this.setState({valuecity: event.target.value})
            } else {
              //console.log("clicked input pop");
              this.setState({valuepop: event.target.value})
            }
          }

          componentDidMount() {
            fetch('http://cities.jonkri.se/')
            .then(function (response) { return response.json(); })
            .then(function (result) { console.log(result); });
          }
          // HEj
  }


    // VICTORIA
    class Updatecity extends React.Component {
        constructor(props) {
          super(props)
          this.state = {
            cities: [],
            id: undefined,
            city: undefined,
            population: undefined,
            newCity: undefined,
            newPopulation: undefined
          }
          this.onClick = this.onClick.bind(this);
        }
        componentDidMount() {
          fetch('http://cities.jonkri.se/')
          .then(function (response) {
            return response.json();
          }).then( result => {
            console.log(result);
            this.setState({
              cities: result
            })
          });
        }
        onChange() {
          fetch('http://cities.jonkri.se/' + this.state.id, {
            body: JSON.stringify({ "name": this.state.newCity, "population": this.state.newPopulation }),
            headers: {
              'Content-Type': 'application/json'
            },
            method: 'PUT'
          }).then(function (response) {
            return response.json();
          }).then( result =>  {
            console.log(result);
          });
        }
        onClick(event) {

          console.log(this.state.city);
        }
        render() {
          var cities = []
          cities = this.state.cities.map(city =>
            <tr key={city.id}>
            <td>{city.name}</td><td>{city.population}</td>
            {/*<button id="editButton" onClick={this.onClick}>Ã„ndrar</button>*/}
            <button id="editButton" onClick={function() {
              console.log(city.id + ", " + city.name + ", " + city.population);

            }}>Ã„ndrar</button>
            </tr>)
            return <div><table>{cities}</table></div>
        }
    }
    //Victoria

    //Emma
    class Updatepopulation extends React.Component {
      constructor(props){
        super(props)
          this.state = { cities: [],
            id: undefined,
            population: undefined,
            cityBeingEdited: undefined}
            this.onUpdateClick = this.onUpdateClick.bind(this)
      }
      onUpdateClick(){
        fetch('http://cities.jonkri.se/' + this.state.id , {
          body: JSON.stringify({ name: this.state.cityBeingEdited, population: this.state.population }),
          headers: {
            'Content-Type': 'application/json'
          },
            method: 'PUT'
          })
        }
        render () {
          var cities = this.state.cities.map(city =>
          <tr key={city.id}>
            <td>{city.name}</td>
            <input onChange={function(event){
              this.state.cityBeingEdited = city.name
              this.state.id = city.id
              city.population = event.target.value
              this.state.population = event.target.value
              this.setState(this.state)}.bind(this)}
              value={city.population}>
            </input>
            <button type="button" onClick={this.onUpdateClick}>Update</button>
          </tr>)
            return <div><table>{cities}</table></div>
        }
        componentDidMount(){
          fetch('http://cities.jonkri.se/').then(response => response.json())
          .then(result => {
            this.setState({ cities: result })
            console.log(result)
          })
        }
      }
      //Emma

    // HANNA
    class Deletecity extends React.Component {

      constructor(props) {
        super(props);
        this.state = { valueID: "City ID"}
        this.onClick = this.onClick.bind(this)
        this.onTextChange = this.onTextChange.bind(this)
      }

      render() {
        return <section>
        <input id="input-id" valueID={this.state.valueID} onChange={this.onTextChange}/>
        <img alt="Trash bin symbol" src="trash-bin-symbol.jpg" onClick={this.onClick} />
        </section>
      }

      onClick(event) {
        var inputId = this.state.valueID;
        fetch(('http://cities.jonkri.se/' + inputId ) , { method: "DELETE" });
        alert("You deleted city with id \"" + this.state.valueID + "\".");
      }

      onTextChange(event) {
        if (event.target.id == "input-id") {
        this.setState({valueID: event.target.value}) }
      }

      componentDidMount() {
        fetch('http://cities.jonkri.se/')
        .then(function (response) { return response.json(); })
        .then(function (result) { console.log(result); });
      }
    }

      ReactDOM.render(<HashRouter>
        <div>
            <nav>
              <ul>
                <li><Link to="/getallcities">Get all Cities</Link></li>
                <li><Link to="/addcity">Add City</Link></li>
                <li><Link to="/updatecity">Update City</Link></li>
                <li><Link to="/updatepopulation">Update Population</Link></li>
                <li><Link to="/deletecity">Delete City</Link></li>
                <li><Link to="/food">Food</Link></li>
            </ul>
          </nav>
        <Route component={Cities} path='/getallcities' />
        <Route component={Addcity} path='/addcity' />
        <Route component={Updatecity} path='/updatecity' />
        <Route component={Updatepopulation} path='/updatepopulation' />
        <Route component={Deletecity} path='/deletecity' />
        <Route component={Food} path='/food' />
        </div>
      </HashRouter>,
        document.getElementById('app')
      );

    </script>

  </body>
</html>
