<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <script src="react.development.js"></script>
    <script src="react-dom.development.js"></script>
    <script src='babel.js'></script>
    <script src='react-router-dom.js'></script>
    <title>YODAZ</title>
  </head>
  <body>

    <style>
    a:link { text-decoration: none; color: black; }
    a:visited { text-decoration: none; color: black; }
    a:active { text-decoration: none; color: black; }
    a:focus { text-decoration: none; color: black; }
    a:hover { text-decoration: none; color: grey; }

    </style>

    <div id="app"></div>
    <script type="text/jsx">
    var HashRouter = ReactRouterDOM.HashRouter;
    var Link = ReactRouterDOM.Link;
    var Route = ReactRouterDOM.Route;

    class Cities extends React.Component {

      constructor(props){
        super()
        this.state = { cities: []}
      }

      componentDidMount(){
        fetch('http://cities.jonkri.se/')
        .then(response => response.json())
        .then(result => {
          console.log(result);
          this.setState({ cities: result}) })
      }

      // When clicking at delete buttin
      onDeleteClick (event) {
        console.log(event.target.dataset.id);
      }

      // When clicking at edit-buttin
      onEditClick (event) {
        console.log(event.target.dataset.id);
      }

      render(){
        var citiesToRender = this.state.cities.map(city =>
          <tr key={city.id} id={city.id} >
            <td>{city.name}</td>
            <td>{city.population}</td>
            <td>
              <button id="penBtn" data-name={city.name} data-population={city.population} data-id={city.id}  onClick={this.onEditClick} style={{marginRight: '5px'}}>ðŸ–Š</button>
              <button id="deleteBtn" data-name={city.name} data-population={city.population} data-id={city.id}  onClick={this.onDeleteClick} style={{marginRight: '5px'}}>ðŸ—‘</button>
            </td>
          </tr>)

        return <div>
          <table style={{backgroundColor: 'gray', color: 'white'}}>
            <thead>
              <tr>
                <th>Stad</th>
                <th>Antal</th>
                <th>Ã„ndra</th>
              </tr>
            </thead>
            <tbody>
              {citiesToRender}
            </tbody>
          </table>
        </div>
      }
    }

    class EditCities extends React.Component {

    }

    class Food extends React.Component {
      render () {
        return  <section><h1>Food</h1><p>...</p></section>
      }
    }

    // MOA
    class Addcity extends React.Component {
            constructor(props) {
              super(props);
              this.state = { valuecity: "", valuepop: "" }
              this.onClick = this.onClick.bind(this)
              this.onTextChange = this.onTextChange.bind(this)
            }

            render() {
              return <section>
              <input id="inputcity" valuecity={this.state.valuecity} onChange={this.onTextChange}/>
              <input id="inputpop" type="number" valuepop={this.state.valuepop} onChange={this.onTextChange}/>
              <button onClick={this.onClick}>ADD CITY!</button>
              </section>
            }

            onClick(event) {
              console.log("City is: " + this.state.valuecity);
              console.log("Population is: " + this.state.valuepop);

              if (this.state.valuecity != "" && this.state.valuepop != ""){
                if (this.state.valuepop != 0){
                  fetch("http://cities.jonkri.se/", {
                    body: JSON.stringify({ "name": this.state.valuecity, "population": this.state.valuepop }),
                    headers: {
                      "Content-Type": "application/json"
                    },
                    method: 'POST'
                  });
                  alert("You sucessfully added " + this.state.valuecity + " with a population of " + this.state.valuepop + ". Nice!");
                  //this.setState({valuecity: ""});
                  //this.setState({valuepop: ""});
                  document.getElementById("inputcity").value = "";
                  document.getElementById("inputpop").value = "";
                } else {
                  alert("The city must have at least one citizen, right?");
                }
              } else {
                alert("You must fill all the fields.");
              }
            }

          onTextChange(event) {
            //console.log(event.target.value);

            if (event.target.id == "inputcity") {
              //console.log("clicked input city");
              this.setState({valuecity: event.target.value})
            } else {
              //console.log("clicked input pop");
              this.setState({valuepop: event.target.value})
            }
          }

          componentDidMount() {
            fetch('http://cities.jonkri.se/')
            .then(function (response) { return response.json(); })
            .then(function (result) { console.log(result); });
          }
  }

    // VICTORIA
    class Updatecity extends React.Component {
        constructor(props) {
          super(props)
          this.state = {
            cities: [],
            city: undefined,
            population: undefined
          }
          this.onClick = this.onClick.bind(this);
        }
        componentDidMount() {
          fetch('http://cities.jonkri.se/')
          .then(function (response) {
            return response.json();
          }).then( result => {
            console.log(result);
            this.setState({
              cities: result
            })
          });
        }
        onChange() {
          fetch('http://cities.jonkri.se/' + {cityId}, {
            body: JSON.stringify({ "name": city, "population": population }),
            headers: {
              'Content-Type': 'application/json'
            },
            method: 'PUT'
          }).then(function (response) {
            return response.json();
          }).then( result =>  {
            console.log(result);
          });
        }
        onClick(event) {
          console.log("HEJ" + event);
          this.onChange()
        }
        render() {
          var cities = []
          cities = this.state.cities.map(city =>
            <tr key={city.id}>
            <td>{city.name}</td><td>{city.population}</td>
            </tr>)
            return <div><table>{cities}</table><button id="editButton" onClick={this.onClick}>Ã„ndrar</button></div>
        }
    }

    //Emma
    class Updatepopulation extends React.Component {
      constructor(props){
        super(props)
          this.state = { cities: [],
            id: undefined,
            population: undefined,
            cityBeingEdited: undefined}
            this.onUpdateClick = this.onUpdateClick.bind(this)
      }
      onUpdateClick(){
        fetch('http://cities.jonkri.se/' + this.state.id , {
          body: JSON.stringify({ name: this.state.cityBeingEdited, population: this.state.population }),
          headers: {
            'Content-Type': 'application/json'
          },
            method: 'PUT'
          })
        }
        render () {
          var cities = this.state.cities.map(city =>
          <tr key={city.id}>
            <td>{city.name}</td>
            <input onChange={function(event){
              this.state.cityBeingEdited = city.name
              this.state.id = city.id
              city.population = event.target.value
              this.state.population = event.target.value
              this.setState(this.state)}.bind(this)}
              value={city.population}>
            </input>
            <button type="button" onClick={this.onUpdateClick}>Update</button>
          </tr>)
            return <div><table>{cities}</table></div>
        }
        componentDidMount(){
          fetch('http://cities.jonkri.se/').then(response => response.json())
          .then(result => {
            this.setState({ cities: result })
            console.log(result)
          })
        }
      }
      //Emma

    // HANNA
    class Deletecity extends React.Component {

      constructor(props) {
        super(props);
        this.state = { valueID: "City ID"}
        this.onClick = this.onClick.bind(this)
        this.onTextChange = this.onTextChange.bind(this)
      }

      render() {
        return <section>
        <input id="input-id" valueID={this.state.valueID} onChange={this.onTextChange}/>
        <img alt="Trash bin symbol" src="trash-bin-symbol.jpg" onClick={this.onClick} />
        </section>
      }

      onClick(event) {
        var inputId = this.state.valueID;
        fetch(('http://cities.jonkri.se/' + inputId ) , { method: "DELETE" });
        alert("You deleted city with id \"" + this.state.valueID + "\".");
      }

      onTextChange(event) {
        if (event.target.id == "input-id") {
        this.setState({valueID: event.target.value}) }
      }

      componentDidMount() {
        fetch('http://cities.jonkri.se/')
        .then(function (response) { return response.json(); })
        .then(function (result) { console.log(result); });
      }
    }

      ReactDOM.render(<HashRouter>
        <div>
            <nav>
              <ul style={{listStyleType: 'none', textAlign: 'center', margin: '0'}}>
                <li style={{display: 'inline', fontSize: '2em', marginRight: '2em'}}>
                <Link to="/getallcities">Get all Cities</Link></li>
                <li style={{display: 'inline', fontSize: '2em', marginRight: '2em'}}>
                <Link to="/addcity">Add City</Link></li>
                <li style={{display: 'inline', fontSize: '2em', marginRight: '2em'}}>
                <Link to="/updatecity">Update City</Link></li>
                <li style={{display: 'inline', fontSize: '2em', marginRight: '2em'}}>
                <Link to="/updatepopulation">Update Population</Link></li>
                <li style={{display: 'inline', fontSize: '2em', marginRight: '2em'}}>
                <Link to="/deletecity">Delete City</Link></li>
                <li style={{display: 'inline', fontSize: '2em', marginRight: '2em'}}>
                <Link to="/food">Food</Link></li>
            </ul>
          </nav>
        <Route component={Cities} path='/getallcities' />
        <Route component={Addcity} path='/addcity' />
        <Route component={Updatecity} path='/updatecity' />
        <Route component={Updatepopulation} path='/updatepopulation' />
        <Route component={Deletecity} path='/deletecity' />
        <Route component={Food} path='/food' />
        </div>
      </HashRouter>,
        document.getElementById('app')
      );

    </script>

  </body>
</html>
